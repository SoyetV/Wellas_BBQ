<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customer Orders - Wella's BBQ</title>
  <link rel="stylesheet" href="adminorder.css" />
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Wella's BBQ</h2>
    <ul>
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="adminorder.html" class="active">Orders</a></li>
      <li><a href="admin.html">Menu</a></li>
      <li><a href="inventory.html">Inventory</a></li>
      <li><a href="customer.html">Customers</a></li>
      <li><a href="report.html">Reports</a></li>
      <li><a href="#">Settings</a></li>
    </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <header>
      <h1>Customer Orders</h1>
    </header>

    <section class="table-container">
      <table>
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer Name</th>
            <th>Items</th>
            <th>Total</th>
            <th>Status</th>
            <th>Time</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="orderTableBody">
          <!-- Orders will be populated here -->
        </tbody>
      </table>
    </section>
  </div>

  <script>
    function renderOrders() {
      const allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];
      const tableBody = document.getElementById("orderTableBody");
      tableBody.innerHTML = "";

      if (allOrders.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='7'>No orders found.</td></tr>";
        return;
      }

      allOrders.forEach((order, index) => {
        const formattedTime = new Date(order.time).toLocaleString("en-PH", {
          dateStyle: "medium",
          timeStyle: "short"
        });

        const customerName = order.customerName || "Guest";

        const row = `
          <tr>
            <td>ORD-${1000 + index}</td>
            <td>${customerName}</td>
            <td>${order.product} x${order.quantity}</td>
            <td>₱${order.total}</td>
            <td>${order.status}</td>
            <td>${formattedTime}</td>
            <td>
              <button class="btn view-btn" onclick="viewOrder(${index})">View</button>
              <button class="btn complete-btn" onclick="markComplete(${index})">Mark Complete</button>
              <button class="btn cancel-btn" onclick="cancelOrder(${index})">Cancel</button>
            </td>
          </tr>
        `;
        tableBody.innerHTML += row;
      });
    }

    function markComplete(index) {
      let allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let completed = JSON.parse(localStorage.getItem("completedOrders")) || [];

      const completedOrder = allOrders[index];
      completedOrder.status = "COMPLETED";

      // Remove from 'orders' if present
      orders = orders.filter(o =>
        !(o.product === completedOrder.product &&
          o.quantity === completedOrder.quantity &&
          o.time === completedOrder.time)
      );

      completed.push(completedOrder);
      localStorage.setItem("orders", JSON.stringify(orders));
      localStorage.setItem("completedOrders", JSON.stringify(completed));
      localStorage.setItem("allOrders", JSON.stringify(allOrders));
      alert("Order marked as completed.");
      renderOrders();
    }

    function cancelOrder(index) {
      if (!confirm("Cancel this order?")) return;

      let allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];
      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let cancelled = JSON.parse(localStorage.getItem("cancelledOrders")) || [];

      const cancelledOrder = allOrders[index];
      cancelledOrder.status = "CANCELLED";

      // Remove from 'orders' if present
      orders = orders.filter(o =>
        !(o.product === cancelledOrder.product &&
          o.quantity === cancelledOrder.quantity &&
          o.time === cancelledOrder.time)
      );

      cancelled.push(cancelledOrder);
      localStorage.setItem("orders", JSON.stringify(orders));
      localStorage.setItem("cancelledOrders", JSON.stringify(cancelled));
      localStorage.setItem("allOrders", JSON.stringify(allOrders));
      alert("Order cancelled.");
      renderOrders();
    }

    function viewOrder(index) {
      const allOrders = JSON.parse(localStorage.getItem("allOrders")) || [];
      const order = allOrders[index];
      alert(`Product: ${order.product}\nQuantity: ${order.quantity}\nCustomer: ${order.customerName || "Guest"}\nStatus: ${order.status}\nTotal: ₱${order.total}`);
    }

    window.addEventListener("DOMContentLoaded", renderOrders);
  </script>
</body>
</html>
